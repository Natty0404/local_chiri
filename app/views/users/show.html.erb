 <div class="container">
  <div class="row">
    <div class="col-lg-3 mt-2">
      <h2 class="mt-3"><strong>My page</strong></h2><br>
      <%= render 'users/info', user: @user %>
      <% if @user == current_user && @user.name != "ゲストユーザー" %>
      <div>
        <%= link_to edit_user_path(@user), class:"btn btn-outline-secondary btn-block edit_user_#{@user.id}" do %>
          <i class="fas fa-user-cog"></i>
        <% end %>
      </div>
      <% end %>
      <div>
        <%= link_to user_favorite_path(@user), class:"btn btn-warning btn-block mt-4 edit_user_#{@user.id}" do %>
          <i class="fas fa-star" style="color: #003f8e;"></i>
        <% end %>
      </div>
    </div>

    <div class="mx-auto col-lg-9">
       <h4 class="mt-5"><strong><%= @user.name %>の聖地巡礼一覧</strong></h4><br>
       <table class='table table-hover table-inverse'>
       <thead>
        <tr>
          <th></th>
          <th>聖地名</th>
          <th>投稿日</th>
          <th>お気に入り数</th>
          <th>コメント数</th>
        </tr>
      </thead>
       <% @posts.each do |post| %>
       <tr>
          <td>
            <%= link_to post_path(post.id) do %>
              <%= image_tag post.get_post_image(100,100) %></td>
            <% end %>
          </td>
          <td>
            <%= link_to post.title, post_path(post.id), class:"post_#[post.id}" %>
          </td>
          <td><%= post.created_at.strftime('%Y/%m/%d') %></td>
          <td class="favorite-btn">
            <%= render "favorites/favorite", post: post %>
          </td>
          <td><%= post.post_comments.count %></td>
       </tr>
       <% end %>
       </tbody>
      </table>
      <%= paginate @posts %>

      <div id="map" style="width: 1000px; height: 250px;"></div>
        <script>
          let map

          const display = document.getElementById('display')

          // mapの表示関数
          function initMap() {
              geocoder = new google.maps.Geocoder()

              // mapの初期位置, 縮尺を定義
              map = new google.maps.Map(document.getElementById('map'), {
                  center: {
                      lat: 35.6458437,
                      lng: 139.7046171
                  },
                  zoom: 12,
              });

              // mapsテーブルにあるそれぞれのレコードをmap上に表示
              <% @posts.each do |post| %>
                  (function(){
                  var contentString = "住所：<%= post.address %>";

                  // マーカーを立てる
                  var marker = new google.maps.Marker({
                      position:{lat: <%= post.latitude %>, lng: <%= post.longitude %>},
                      map: map,
                      title: contentString
                  });

                  // 情報ウィンドウ(吹き出し)の定義
                  // 投稿の詳細ページへのリンクも
                  var infowindow = new google.maps.InfoWindow({
                  position: {lat: <%= post.latitude %>, lng: <%= post.longitude %>},
                  content: "<a href='<%= post_path(post.id) %>' target='_blank'><%= post.title %><br><%= post.body %></a>"
                  });

                  // クリックしたときに情報ウィンドウを表示
                  marker.addListener('click', function() {
                  infowindow.open(map, marker);
                  });

                  })();
              <% end %>
          }

          let geocoder

          // 地図検索関数
          function codeAddress() {
              let inputAddress = document.getElementById('address').value;

              geocoder.geocode({
                  'address': inputAddress
              }, function (results, status) {
                  if (status == 'OK') {
                      map.setCenter(results[0].geometry.location);
                      var marker = new google.maps.Marker({
                          map: map,
                          position: results[0].geometry.location
                      });

                  display.textContent = "検索結果：" + results[ 0 ].geometry.location
                  } else {
                      alert('該当する結果がありませんでした：' + status);
                  }
              });
          }
      </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=<%=ENV['SECRET_KEY']%>&callback=initMap"></script>
    </div>
  </div>
</div>
